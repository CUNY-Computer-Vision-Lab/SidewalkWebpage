@import models.user.User
@import models.mission.{MissionTable, Mission}
@import models.label.LabelTable
@import models.label.LabelTable.LabelValidationMetadata
@import play.api.libs.json.Json
@import play.api.libs.json.JsValue
@import views.html.bootstrap._

@(title: String, user: Option[User] = None, mission: Option[JsValue], labelList: Option[JsValue], hasNextMission: Boolean)

@main(title) {
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVValidate/build/SVValidate.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/lib/gsv/zpipe.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/lib/gsv/jquery.base64.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/lib/kinetic-v4.3.3.min.js")'></script>
    <link rel="stylesheet" href='@routes.Assets.at("javascripts/SVValidate/build/SVValidate.css")'/>
    <link rel="stylesheet" href='@routes.Assets.at("javascripts/SVValidate/mobile/mobileValidate.css")'/>

    <script>

            $(document).ready(function() {

                //raleway doesn't load after being redirected from another page; redeclaring the font-face fixes that
                var font = "<style> @@font-face{ font-family: 'raleway'; src: url('/assets/fonts/Raleway/Raleway-Regular.ttf');} </style>";
                $("head").append(font);

                function orientationCheck(){
                    if(window.innerHeight > window.innerWidth){
                        $('html').css('padding-top','10px');
                    } else {
                        $('html').css('padding-top','0px');
                    }
                }

                console.log("does this only print once?");

                $('html').css('position', 'fixed');
                $('body').css({
                    'height': '100vh',
                    'width': '100vw',
                    'text-align': 'center',
                    'padding': '2vh 10vw',
                    'font-family': 'raleway, sans-serif',
                    'color': '#777'
                });
                window.addEventListener("resize", function() {
                    orientationCheck();
                }, false);
                $('.filler').css('display', 'none');
                $('#footer-container').css('display', 'none');
                $('#info-footer').css('display', 'none');
                orientationCheck();
            });
    </script>

    <div id='status-current-mission-completion-bar'>
        <div id='status-current-mission-completion-bar-filler'>
            <div id='status-current-mission-completion-rate'></div>
        </div>
    </div>
    <br class="clear">

    <div id="title-bar-holder">
        <button id="back-button"><img src='@routes.Assets.at("javascripts/SVLabel/img/misc/back_button.png")'></button>
        <div id="upper-menu-title-bar"></div>
        <button id="info-button" class="button info-button" data-toggle="tooltip" data-placement="top"><img src='@routes.Assets.at("javascripts/SVLabel/img/misc/info_button.png")'></button>
        <!---<button id="skip-button"><img src='@routes.Assets.at("javascripts/SVLabel/img/misc/skip_button.png")'></button>-->
        <button id="left-column-jump-button">
            <img src='@routes.Assets.at("javascripts/SVLabel/img/misc/skip_button.png")'  alt="Jump icon">
        </button>

    </div>

    <div id="mobile-viewer">
        <div id="svv-panorama-holder">
                <div id="svv-panorama-outline">
                    <div id="svv-panorama">
                    </div>
                </div>
        </div>
        <div id="validation-button-holder">
            <button id="validation-disagree-button" class="validation-button">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/Cross.png")' class="validation-status-icon" alt="Disagree" align="">
                <u>D</u>isagree
            </button>
            <button id="validation-not-sure-button" class="validation-button">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/QuestionMark.png")' class="validation-status-icon" alt="Not sure" align="">
                <u>N</u>ot sure
            </button>
            <button id="validation-agree-button" class="validation-button">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/Checkmark.png")' class="validation-status-icon" alt="Agree" align="">
                <u>A</u>gree
            </button>
        </div>
        <div id="modal-mission-holder">
            <div id="modal-mission-background" class="modal-background"></div>
            <div id="modal-mission-foreground" class="modal-foreground">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/logo.png")' id="ps-logo-mission"></img>
                <h1 id="modal-mission-header" class="text-center"></h1>
                <div id="modal-mission-instruction"></div>
                <button class="button" id="modal-mission-close-button">OK</button>
            </div>
        </div>
        <div id="modal-info-holder">
            <div id="modal-info-background" class="modal-background"></div>
            <div id="modal-info-foreground" class="modal-foreground">
                <div id="modal-info-header" class="text-center"></div>
                <div id="modal-info-description"></div>
                <div class="status-box">
                    <h1 class="status-holder-header-1" id="label-type-example"></h1>
                    <div id="example-image-holder">
                        <img id="example-image-1" class="example-image">
                        <img id="example-image-2" class="example-image">
                    </div>
                </div>
                <div class="status-box">
                    <h1 class="status-holder-header-2" id="label-type-counterexample"></h1>
                    <div id="example-image-holder">
                        <img id="counterexample-image-1" class="example-image">
                        <img id="counterexample-image-2" class="example-image">
                    </div>
                </div>
                <button class="button" id="modal-info-close-button">OK</button>
                <button class="button" id="left-column-feedback-button">Leave Feedback</button>
            </div>
            <div id="modal-comment-holder" class="hidden">
                <div id="modal-comment-box" class="modal-foreground">
                    <form id="comment-form">
                        <div id="modal-comment-title" class="bold">
                            <p>
                                Any thoughts? Found something confusing? Spotted a bug? <br />
                                Send us comments!
                            </p>
                        </div>
                        <div id="modal-comment-content">
                            <textarea id="modal-comment-textarea" placeholder=""></textarea>
                        </div>
                        <div>
                            <button class="button" id="modal-comment-ok-button" type="button">OK</button>&nbsp;
                            <button class="button" id="modal-comment-cancel-button" type="button">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div id="modal-mission-complete-holder">
            <div id="modal-mission-complete-background" class="modal-background"></div>
            <div id="modal-mission-complete-foreground" class="modal-foreground">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/logo.png")' id="ps-logo-mission-complete"></img>
                <h1 class="normal" id="modal-mission-complete-title"></h1>
                <p><div id="modal-mission-complete-message"></div></p>
                <div id="modal-mission-complete-table">
                    <div class="col-sm-8">
                        <h3>Category</h3>
                        <table class="table">
                            <tr>
                                <th>Agree</th>
                                <td id="modal-mission-complete-agree-count" class="col-right text-right"></td>
                            </tr>
                            <tr>
                                <th>Disagree</th>
                                <td id="modal-mission-complete-disagree-count" class="col-right text-right"></td>
                            </tr>
                            <tr>
                                <th>Not Sure</th>
                                <td id="modal-mission-complete-not-sure-count" class="col-right text-right"></td>
                            </tr>
                        </table>
                        <button class="btn blue-btn" id="modal-mission-complete-close-button">Validate more labels</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="modal-landscape-holder">
            <div id="modal-landscape-background" class="modal-background"></div>
            <div id="modal-landscape-foreground" class="modal-foreground">
                <img src='@routes.Assets.at("javascripts/SVValidate/img/logo.png")' id="ps-logo-mission"></img>
                <div>
                    <p id="modal-landscape-header">
                        Thanks for visiting!
                    </p>
                    <br /><br />
                    <p id="modal-landscape-description">
                        We do not currently support landscape mode on mobile or tablet devices.
                        Please use portrait mode to proceed to Project Sidewalk.
                    </p>
                </div>
                <br />
            </div>
        </div>

    </div>

    <!-- resize elements based on phone size -->
    <script>
            var h = window.innerHeight;
            var w = window.innerWidth;

            //change validation button position
            document.getElementById("validation-button-holder").style.top = h - 200 + "px";
            document.getElementById("validation-button-holder").style.width = w + "px";
            document.getElementById("validation-agree-button").style.width = w/3-30 + "px";
            document.getElementById("validation-disagree-button").style.width = w/3-30 + "px";
            document.getElementById("validation-not-sure-button").style.width = w/3-30 + "px";
            //scale progress bar
            document.getElementById("status-current-mission-completion-bar").style.width = w + "px";
            document.getElementById("status-current-mission-completion-bar").style.width = w + "px";
            document.getElementById("status-current-mission-completion-rate").style.width = w + "px";
            //resize button elements
            document.getElementById("title-bar-holder").style.width = w + "px";
            document.getElementById("left-column-jump-button").style.left = w - 75 + "px";
            document.getElementById("info-button").style.left = w - 150 + "px";
            //resize mission start popup
            var modalForegrounds = document.getElementsByClassName("modal-foreground");
            for (var i = 0; i < modalForegrounds.length; i++) {
                modalForegrounds[i].style.width = w + "px";
                modalForegrounds[i].style.height = h + "px";
            }
            document.getElementById("ps-logo-mission").style.width = w -70+ 'px';
            document.getElementById("ps-logo-mission-complete").style.width = w -70+ 'px';
            //resize modal info panel
            var exampleImages = document.getElementsByClassName("example-image");
            for (i = 0; i < exampleImages.length; i++) {
                exampleImages[i].style.width = w/2 - 50 + "px";
                exampleImages[i].style.height = (w/2 - 50)*(83/95) + "px";
            }
            var statusBoxes = document.getElementsByClassName("status-box");
            for (i = 0; i < statusBoxes.length; i++) {
                statusBoxes[i].style.height = w*(83/95)/2 + 20 + "px";
            }
            document.getElementById("modal-info-close-button").style.left = w - 75 + "px";
            //resize comment panel

            //if you need to do functional testing without a phone, enable this code to test using Chrome's inspection tool
            document.getElementById("validation-button-holder").style.top = h - 1500 + "px";
            document.getElementById("validation-button-holder").style.width = w + "px";
            document.getElementById("validation-agree-button").style.width = w/5-30 + "px";
            document.getElementById("validation-disagree-button").style.width = w/5-30 + "px";
            document.getElementById("validation-not-sure-button").style.width = w/5-30 + "px";
            document.getElementById("left-column-jump-button").style.left = w - 600 + "px";


    </script>

    <script type="text/javascript">
            var svv = svv || {};
            var param = {};

            param.dataStoreUrl = '@routes.ValidationTaskController.post';
            param.hasNextMission = @hasNextMission;

            if (@hasNextMission) {
                param.mission = @Html(mission.getOrElse("\"\"").toString);
                param.labelList = @Html(labelList.getOrElse("\"\"").toString);

                // Initializes an object of labels from label metadata.
                // {key, labelMetadata} --> {key, Label}, where key = the index of the label.
                Object.keys(param.labelList).map(function (key, index) {
                    var labelMetadata = {
                        canvasHeight: param.labelList[key].canvas_height,
                        canvasWidth: param.labelList[key].canvas_width,
                        canvasX: param.labelList[key].canvas_x,
                        canvasY: param.labelList[key].canvas_y,
                        gsvPanoramaId: param.labelList[key].gsv_panorama_id,
                        heading: param.labelList[key].heading,
                        labelId: param.labelList[key].label_id,
                        labelType: param.labelList[key].label_type,
                        pitch: param.labelList[key].pitch,
                        zoom: param.labelList[key].zoom
                    };
                    param.labelList[key] = new Label(labelMetadata);
                });
            }

            svv.main = new Main(param);

    </script>
}