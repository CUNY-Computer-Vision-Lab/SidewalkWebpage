@import models.user.User
@import models.region.Region
@(title: String, task: Option[models.audit.NewTask] = None, region: Option[Region], user: Option[User] = None)

@main(title) {
    @navbar(user, Some("/audit"))

    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/build/SVLabel.js")'></script>
    <!--<script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/build/SVLabel/Onboarding/Onboarding.js")'></script>-->
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/lib/gsv/zpipe.min.js")'></script>
    <script type="text/javascript" src='@routes.Assets.at("javascripts/SVLabel/lib/gsv/jquery.base64.min.js")'></script>

    <link rel="stylesheet" href='@routes.Assets.at("javascripts/SVLabel/build/SVLabel.css")'/>
    <link rel="stylesheet" href='@routes.Assets.at("stylesheets/animate.css")'/>
    <div class="container">
        <div id="svl-application-holder">
            <div id="left-column-control-pane">
                <div id="left-column-button-holder">
                    <div id="left-column-sound-button" class="button">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/sound.png")' id="left-column-sound-icon" class="visible" alt="Sound icon" align="">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/sound_mute.png")' id="left-column-mute-icon" class="hidden" alt="Mute icon" align="">
                        Sound
                    </div>
                    <div class="spacer10"></div>
                    <div id="left-column-jump-button" class="button">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/refresh.png")'  alt="Jump icon" align="">
                        Jump
                    </div>
                    <div class="spacer10"></div>
                    <div id="left-column-feedback-button" class="button">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/comment.png")'  alt="Comment icon" align="">
                        Feedback
                    </div>
                </div>
                @*<div id="comment-textarea-holder">*@
                @*<textarea id="comment-field" placeholder="Please enter any comments about the streets and sidewalks that may affect people with mobility impairments (optional)"></textarea>*@
                @*</div>*@
            </div>
            <div id="ribbon-menu-holder">
                <span id="ribbon-menu-left-column-holder">
                    <div id="ribbon-menu-left-column-title"></div>
                    <div id="ribbon-menu-left-column-button-holder">
                        <span class="modeSwitch" val="Walk" id="modeSwitchWalk" style="">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Icon_Walker.png")'  id="icon-explore" class="icon-ribbon-menu-large" alt="Mode switch: Walk" align="">
                            </span>
                            <span class="modeSwitch_Name" style="position:absolute; left: 0px;"><u>E</u>xplore</span>
                            <div id="ribbon-mode-switch-horizontal-line-walk" class="ribbon-menu-mode-switch-horizontal-line" val="Walk"></div>
                        </span>
                    </div>
                </span>
                <span id="landmark-holder">
                    <div id="ribbon-menu-landmark-title">
                        Find and label the following
                    </div>
                    <div id="ribbon-menu-landmark-button-holder">
                        <span id="ModeSwitchButton_CurbRamp" class="modeSwitch" val="CurbRamp">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_CurbRamp.svg")' class="icon-ribbon-menu-large" alt="Mode switch:" align="">
                            </span>
                            <div class="modeSwitch_Name"><u>C</u>urb Ramp</div>
                            <div class="ribbon-menu-mode-switch-horizontal-line" val="CurbRamp"></div>
                        </span>
                        <span id="ModeSwitchButton_NoCurbRamp" class="modeSwitch" val="NoCurbRamp">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_NoCurbRamp.svg")' class="icon-ribbon-menu-large" alt="Mode switch:" align="">
                            </span>
                            <span class="modeSwitch_Name"><u>M</u>issing Curb Ramp</span>
                            <div class="ribbon-menu-mode-switch-horizontal-line" val="NoCurbRamp"></div>
                        </span>

                        <span id="ModeSwitchButton_Obstacle" class="modeSwitch" val="Obstacle">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_Obstacle.svg")' class="icon-ribbon-menu-large" alt="Mode switch:" align="">
                            </span>
                            <span class="modeSwitch_Name"><u>O</u>bstacle in <br /> a Path</span>
                            <div class="ribbon-menu-mode-switch-horizontal-line" val="Obstacle"></div>
                        </span>
                        <span id="ModeSwitchButton_SurfaceProblem" class="modeSwitch" val="SurfaceProblem">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_SurfaceProblem.svg")' class="icon-ribbon-menu-large" alt="Mode switch:" align="">
                            </span>
                            <span class="modeSwitch_Name"><u>S</u>urface Problem</span>
                            <div class="ribbon-menu-mode-switch-horizontal-line" val="SurfaceProblem"></div>
                        </span>
                        <span id="ModeSwitchButton_Other" class="modeSwitch" val="Other">
                            <span class="modeSwitch_Icon">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_Other2.svg")' class="icon-ribbon-menu-large" alt="Mode switch:" align="">
                            </span>
                            <span class="modeSwitch_Name">
                                Other
                            </span>
                            <div class="ribbon-menu-mode-switch-horizontal-line" val="Other"></div>
                            <div id="ribbon-menu-other-subcategory-holder">
                                <div class="ribbon-menu-other-subcategories" val="Occlusion">
                                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_Occlusion.png")' class="icon-ribbon-menu-medium" alt="Occluded sidewalk icon">
                                    Can't see the sidewalk
                                </div>
                                <hr>
                                <div class="ribbon-menu-other-subcategories" val="NoSidewalk">
                                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_NoSidewalk.png")' class="icon-ribbon-menu-medium" alt="No sidewalk icon">
                                    No sidewalk
                                </div>
                                <hr>
                                <div class="ribbon-menu-other-subcategories" val="Other">
                                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Sidewalk/Icon_Other.png")' class="icon-ribbon-menu-medium" alt="Other icon">
                                    Other
                                </div>
                            </div>
                        </span>
                    </div>
                </span>
            </div>
            <div id="zoom-control-holder"></div>
            <div id="action-stack-control-holder"></div>
            <div id="interaction-area-holder" onSelectStart="return true;">
                <div id="street-view-holder">
                    <div id="ribbon-street-view-connector"><!-- border --></div>
                    <!-- You can put an extra div element on top of the Street View div panel to disable any of StreetView control. -->
                    <div id="pano" class="Window_StreetView" style="z-index: 0;" ></div>
                    <div id="overlay-message-holder" class="Window_StreetView"></div>
                    <div id="onboarding-holder" class="Window_StreetView"></div>

                    <div id="userControlLayer"  class="Window_StreetView" style="z-index: 0;">
                        <div id="viewControlLayer"  class="Window_StreetView" style="cursor: url(/assets/javascripts/SVLabel/img/cursors/openhand.cur) 4 4, move; z-index: 1;">
                            <!-- In IE, it seems like a div element that has nothing inside gets neglected...
                                So I put an empty canvas as a place holder.
                            -->
                            <!--[if IE]>
                            <canvas width="720px" height="480px"  class="Window_StreetView" style=""></canvas>
                            <![endif]-->
                        </div>
                        <div id="labelDrawingLayer"  class="Window_StreetView" style="z-index: 0;">
                            <canvas id="label-canvas"  class="Window_StreetView" width="720px" height="480px" style="cursor: default, move;"></canvas>
                        </div>
                    </div>
                    <div id="delete-icon-holder">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Icon_Delete.png")' id="LabelDeleteIcon" />
                    </div>
                    <div id="Holder_LabelEditIcon">
                        <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/Icon_Edit.png")' id="LabelEditIcon" />
                    </div>
                    <div id="context-menu-holder">
                        <div id="severity-menu">
                            <div id="severity-radio-holder">
                                <div class="radio-inline" id="column-passable">
                                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/WheelchairAccessible.png")' alt="Wheelchair accessible icon">
                                    <div class="problem-severity-axis-label">Passable</div>
                                </div>
                                <div class="radio-inline">
                                    <label><input type="radio" name="problem-severity" value="1"><div>1</div></label>
                                </div>
                                <div class="radio-inline">
                                    <label><input type="radio" name="problem-severity" value="2"><div>2</div></label>
                                </div>
                                <div class="radio-inline">
                                    <label><input type="radio" name="problem-severity" value="3"><div>3</div></label>
                                </div>
                                <div class="radio-inline">
                                    <label><input type="radio" name="problem-severity" value="4"><div>4</div></label>
                                </div>
                                <div class="radio-inline">
                                    <label><input type="radio" name="problem-severity" value="5"><div>5</div></label>
                                </div>
                                <div class="radio-inline" id="column-not-passable">
                                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/WheelchairInaccessible.png")' alt="Wheelchair inaccessible icon">
                                    <div class="problem-severity-axis-label">Not Passable</div>
                                </div>
                            </div>
                        </div>
                        <div class="spacer10"></div>
                        <div id="problem-property-menu">
                            <div>
                                <div class="checkbox-inline">
                                    <label><input type="checkbox" id="context-menu-temporary-problem-checkbox" value="temporary-problem">Temporary Problem</label>
                                </div>
                            </div>
                            <div>
                                <div>
                                    <input type="text" class="form-control" placeholder="Description" id="context-menu-problem-description-text-box">
                                </div>
                            </div>
                        </div>
                        <div id="context-menu-vertical-connector"></div>
                    </div>
                </div>
                <div id="status-holder">
                    @*<div id="status-pane-title">*@
                        @*Status*@
                    @*</div>*@
                    @*<div id="current-status-holder" class="status-box">*@
                        @*<div id="current-status-title">*@
                            @*Mission:*@
                        @*</div>*@
                        @*<div id="current-status-description">*@
                            @*A description of a user's current mission.*@
                        @*</div>*@
                    @*</div>*@
                    @*<div id="progress-holder" class="status-box">*@
                        @*<div id="Progress_Title">*@
                            @*<span class="bold">Progress:</span>*@
                        @*</div>*@
                        @*<div id="Progress_Description">*@
                            @*<div id="ProgressBarContainer">*@
                                @*<div id="ProgressBarFilled">*@
                                @*</div>*@
                            @*</div>*@
                            @*<div id="Progress_Message">*@
                                @*You are half way done with tutorials!*@
                            @*</div>*@
                        @*</div>*@
                    @*</div>*@
                    <div class="status-box">
                        <span class="status-holder-header-1">Achievements</span>
                        <div id="status-achievements-holder">
                            <div class="status-column-half inline">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/podium.png")' class="status-icon" alt="Podium icon" align="">
                                <span><span class="bold">2</span><small>nd</small></span>
                            </div>
                            <div class="status-column-half inline">
                                <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/map.png")' class="status-icon" alt="Podium icon" align="">
                                <span><span class="bold" id="status-audited-distance">0</span><small>miles</small></span>
                            </div>
                            <br class="clear">
                        </div>
                    </div>
                    <div class="status-box">
                        <span class="status-holder-header-1">Current Mission</span>
                        <div id="progress-pov-holder">
                            <div id='progress-pov-current-completion-bar'>
                                <div id='progress-pov-current-completion-bar-filler'>
                                    <div id='progress-pov-current-completion-rate'></div>
                                </div>
                            </div>
                        </div>
                        <div id="counter-holder">
                            @*<div id="counter-title"><span class="bold">You have labeled:</span></div>*@
                            <div id="label-counter"></div>
                        </div>
                    </div>
                </div>
                <div id="google-maps-holder"></div>
            </div>
            <div id="compass-holder" class="">
                <div id="compass-message-holder" class="animated">
                    <span id="compass-message"></span>
                    <div id="compass-message-connector"></div>
                </div>
            </div>
            @*<div id="form-holder">*@
                @*<form id="svl-form" method="Post" action="http://www.mturk.com/mturk/externalSubmit">*@
                    @*<input type="hidden" name="assignmentId" value="" />*@
                    @*<input type="hidden" name="workerId" value=""/>*@
                    @*<input type="hidden" name="hitId" value="" />*@
                    @*<div id="comment-field-holder">*@
                        @*<textarea id="comment-field" placeholder="Please enter any comments about the streets and sidewalks that may affect people with mobility impairments (optional)"></textarea>*@
                    @*</div>*@
                    @*<div id="form-buttons-holder">*@
                        @*<button id="skip-button" class="button" onclick="return false;">Jump to another location</button>*@
                        @*<!--<input type="submit" id="submit-button" class="button" style="margin-top: 3px; width:635px;" value="Submit" />-->*@
                    @*</div>*@
                @*</form>*@
            @*</div>*@

            <div id="page-overlay-holder">
                <!--<img src='@routes.Assets.at("javascripts/SVLabel/img/misc/AjaxLoader.gif")' id="ajax-loader-image">-->
            </div>
            <div id="pop-up-message-holder" class="hidden">
                <div id="pop-up-message-background"></div>
                <div id="pop-up-message-box">
                    <div id="pop-up-message-title" class="bold">Title</div>
                    <div id="pop-up-message-content">Content</div>
                </div>
            </div>
            <div id="modal-skip-holder" class="hidden">
                <div id="modal-skip-background"></div>
                <div id="modal-skip-box">
                    <div id="modal-skip-title" class="bold">
                        <p>Jump to another location because:</p>
                    </div>
                    <div id="modal-skip-content">
                        <div class="radio">
                            <label><input class="modal-skip-radio-buttons" type="radio" value="IWantToExplore" name="modal-skip-radio">I want to explore another area!</label>
                        </div>
                        <div class="radio">
                            <label><input class="modal-skip-radio-buttons" type="radio" value="GSVNotAvailable" name="modal-skip-radio">Street View is not available and I cannot walk towards the goal.</label>
                        </div>
                        <div>
                            <button class="button" id="modal-skip-ok-button">OK</button>&nbsp;
                            <button class="button" id="modal-skip-cancel-button">Cancel</button>
                        </div>
                    </div>

                </div>
            </div>
            <div id="modal-comment-holder" class="hidden">
                <div id="modal-comment-background"></div>
                <div id="modal-comment-box">
                    <form id="comment-form">
                        <div id="modal-comment-title" class="bold">
                            <p>Please enter any comments about the streets and sidewalks that may affect people with mobility impairments.</p>
                        </div>
                        <div id="modal-comment-content">
                            <textarea id="modal-comment-textarea" placeholder=""></textarea>
                        </div>
                        <div>
                            <button class="button" id="modal-comment-ok-button">OK</button>&nbsp;
                            <button class="button" id="modal-comment-cancel-button">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
            <div id="modal-mission-holder" class="hidden">
                <div id="modal-mission-background"></div>
                <div id="modal-mission-box">
                </div>
            </div>
            <div id="annotation-holder"></div>
            <div id="task-completion-message-holder">
                <img src='@routes.Assets.at("javascripts/SVLabel/img/misc/GoodJob.png")' alt="Task completion message: Good Job!" />
            </div>
        </div>
    </div>

    <template class="missions" val="initial-mission">
        <div id="modal-mission-header">
            <div class="row">
                <div class="col-md-12">
                    <h2>Mission</h2>
                </div>
            </div>
        </div>
        <div class="spacer20"></div>
        <div id="modal-mission-body">
            <div class="row">
                <div class="col-md-6">
                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/StreetAccessibility.png")' class="modal-mission-images center-block" alt="Street accessibility" />
                </div>
                <div class="col-md-6">
                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/AccessibilityFeatures.png")' class="modal-mission-images center-block" alt="Street accessibility features" />
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    The sidewalk accessibility affects how people with
                    mobility impairments move about the city.
                </div>
                <div class="col-md-6">
                    Your mission is to <span class="bold">find all the accessibility attributes thataffect mobility impaired travelers.</span>
                </div>
            </div>
        </div>
        <div class="spacer30"></div>
        <div id="modal-mission-footer">
            <div class="row">
                <div class="col-md-9"></div>
                <div class="col-md-3"><button class="button ok-button">OK</button></div>
            </div>
        </div>
    </template>
    <template class="missions" val="initial-mission-complete">
        <div id="modal-mission-body">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <img src='@routes.Assets.at("javascripts/SVLabel/img/icons/AccessibilityFeatures.png")' class="modal-mission-images center-block" alt="Street accessibility features" />
                </div>
                <div class="col-md-2"></div>
            </div>
            <div class="spacer10"></div>
            <div class="row">
                <div class="col-md-1"></div>
                <div class="col-md-10">
                    Good job! You have successfully completed the first mission!
                </div>
                <div class="col-md-1"></div>
            </div>
        </div>
        <div class="spacer10"></div>
        <div id="modal-mission-footer">
            <div class="row">
                <div class="col-md-9"></div>
                <div class="col-md-3"><button class="button ok-button">OK</button></div>
            </div>
        </div>
    </template>
    <template class="missions" val="area-coverage">
        <div id="modal-mission-body">
            <div class="row">
                <div class="col-md-4" id="modal-mission-area-coverage-left-column">
                </div>
                <div class="col-md-8">
                    <h2>Mission</h2>
                    <p>Your goal is to <span class="bold">audit <span id="modal-mission-area-coverage-rate"></span>%
                        of the entire streets in this neighborhood</span> and find all the accessibility attributes!
                    </p>
                </div>
            </div>
        </div>
        <div id="modal-mission-footer">
            <div class="row">
                <div class="col-md-9"></div>
                <div class="col-md-3"><button class="button ok-button">OK</button></div>
            </div>
        </div>
    </template>
    <template class="missions" val="mission-completion">
        <div id="modal-mission">
            <div class="row">
                <h2>Congrats! You've completed the mission.</h2>
            </div>
        </div>
        <div id="modal-mission-footer">
            <div class="row">
                <div class="col-md-9"></div>
                <div class="col-md-3"><button class="button ok-button">OK</button></div>
            </div>
        </div>
    </template>

    <script type="text/javascript" src='@routes.Assets.at("javascripts/lib/turf.min.js")'></script>
    <script type="text/javascript">
        var svl = svl || {};
        svl.storage = new Storage(JSON);

        @if(user) {
        var userParam = { username : '@user.get.username' };
        svl.user = new User(userParam);
        } else {
        var userParam = { username : "anonymous" };
        svl.user = new User(userParam);
        }

        @if(task) {
            svl.taskFactory = TaskFactory(turf);
            svl.taskContainer = TaskContainer(turf);

            var geojson = @Html(task.get.toJSON.toString);
            var lat1 = geojson.features[0].geometry.coordinates[0][1],
                lng1 = geojson.features[0].geometry.coordinates[0][0];

            var streetViewService = new google.maps.StreetViewService();
            var STREETVIEW_MAX_DISTANCE = 25;
            var latLng = new google.maps.LatLng(lat1, lng1);
            streetViewService.getPanoramaByLocation(latLng, STREETVIEW_MAX_DISTANCE, function (streetViewPanoramaData, status) {
                if (status === google.maps.StreetViewStatus.OK) {
                    // Ok
                    var newTask = svl.taskFactory.create(geojson, lat1, lng1);
                    svl.taskContainer.setCurrentTask(newTask);
                    init();
                } else if (status === google.maps.StreetViewStatus.ZERO_RESULTS) {
                    // no street view available in this range.
                    location.reload();  // Todo. I need a better solution than this one.
                } else {
                    throw "Error loading Street View imagey.";
                }

            });
        }

        $(document).ready(function () {
            var _pointCloudLoader = new GSVPANO.PanoPointCloudLoader();
            _pointCloudLoader.onPointCloudLoad = function () {
                svl.pointCloud = this.pointCloud;
            };
            _pointCloudLoader.load(this.panoId);
        });

        $(document).ready(function(){
            // Solutions to annoying text selection cursor.
            // http://forum.jquery.com/topic/chrome-text-select-cursor-on-drag
            document.onselectstart = function () { return false; };
        });

        function init() {
            var mainParam = {}, formParam = {}, initialLocation = svl.taskContainer.getCurrentTask().initialLocation();
            formParam.dataStoreUrl = '@routes.TaskController.post';
            formParam.hitId = '';
            formParam.assignmentId = '';
            formParam.turkerId = '';
            formParam.onboarding = false;
            formParam.taskPanoramaId = "";
            formParam.taskDescription = "";
            formParam.domIds = {};
            formParam.domIds.canvas = 'onboardingCanvas';
            mainParam.form = formParam;
            // mainParam.panoId = '_AUz5cV_ofocoDbesxY3Kw';
            // mainParam.initLat = 38.894799;
            // mainParam.initLng = -77.021906;
            mainParam.initLat = initialLocation.lat;
            mainParam.initLng = initialLocation.lng;
            mainParam.rootDirectory = "/assets/javascripts/SVLabel/";

            var missionDescriptionParam = {};
            missionDescriptionParam.description = "";
            mainParam.missionDescription = missionDescriptionParam;

            @if(region) {
                mainParam.regionId = @region.get.regionId;
            }

            svl.main = Main($, mainParam);

        }
    </script>

}
